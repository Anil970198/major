<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>✉️ Respond to Email</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown-light.min.css" />
</head>

<body class="bg-gradient-to-r from-blue-100 via-white to-blue-100 min-h-screen p-6 flex justify-center">

  <div class="bg-white shadow-lg rounded-xl max-w-3xl w-full p-8">

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-6 space-y-2">
          {% for category, message in messages %}
            <div class="p-4 text-sm rounded border
              {% if category == 'success' %}
                bg-green-100 text-green-800 border-green-300
              {% elif category == 'danger' %}
                bg-red-100 text-red-800 border-red-300
              {% elif category == 'warning' %}
                bg-yellow-100 text-yellow-800 border-yellow-300
              {% else %}
                bg-gray-100 text-gray-800 border-gray-300
              {% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- From -->
    <p class="mb-2"><strong>From:</strong> {{ email.from_addr or "Unknown" }}</p>

    <!-- Snippet -->
    <!-- Full Email Content -->
    <p class="font-semibold mt-4 mb-2">Email Content:</p>
    <div class="markdown-body bg-gray-100 p-4 rounded text-sm border border-gray-300 mb-6">
      {{ email.body | markdown }}
    </div>

    <!-- Reply Form -->
    <form method="POST" action="{{ url_for('send_reply_action', email_id=email.id) }}">
      <p class="font-semibold mb-2">Draft Reply:</p>
      <textarea name="final_draft" rows="12"
                class="w-full border rounded p-4 mb-4 text-sm focus:ring focus:ring-blue-200">{{ email.draft_reply or "" }}</textarea>

      <!-- Tone Selector -->
      <div class="mb-6 flex items-center gap-2">
        <label for="tone" class="font-medium">Select Tone:</label>
        <select name="tone" id="tone" class="border rounded p-2">
          <option value="formal">Formal</option>
          <option value="casual">Casual</option>
          <option value="assertive">Assertive</option>
          <option value="friendly">Friendly</option>
          <option value="apologetic">Apologetic</option>
        </select>
      </div>

      <!-- Buttons -->
      <div class="flex flex-wrap justify-center gap-4">
        <button type="submit"
                formaction="{{ url_for('rewrite_draft_action', email_id=email.id) }}"
                class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded">
          ✍️ Rewrite in Selected Tone
        </button>

        <button type="submit"
                class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
          📤 Send Reply
        </button>

        <a href="{{ url_for('emails') }}"
           class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
          🏠 Back to Inbox
        </a>
      </div>
    </form>
  </div>
</body>
</html>
