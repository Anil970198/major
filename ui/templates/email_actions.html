<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Email Actions</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-blue-100 via-white to-blue-100 min-h-screen p-6 flex justify-center">

  <div class="bg-white shadow-lg rounded-lg max-w-3xl w-full p-8">
    <!-- FLASH MESSAGES -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="mb-4">
      {% for category, message in messages %}
        <div class="p-4 mb-2 text-sm rounded
                    {% if category == 'success' %}bg-green-100 text-green-800 border border-green-400
                    {% elif category == 'danger' %}bg-red-100 text-red-800 border border-red-400
                    {% elif category == 'warning' %}bg-yellow-100 text-yellow-800 border border-yellow-400
                    {% else %}bg-gray-100 text-gray-800 border border-gray-300{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}


    <!-- FROM ADDRESS -->
    <p class="mb-2"><strong>From:</strong> {{ email.from_addr or "Unknown" }}</p>

    <!-- SNIPPET (improved display) -->
    <p class="mb-2 font-semibold">Email Snippet:</p>
    <div class="bg-gray-100 p-4 rounded mb-4 text-sm text-gray-700 whitespace-pre-wrap leading-relaxed border border-gray-300">
      {{ email.snippet or "No snippet available." }}
    </div>

    <!-- DRAFT REPLY -->
    <p class="mb-2 font-semibold">Draft Reply:</p>
    <form action="{{ url_for('send_reply_action', email_id=email.id) }}" method="post">
      <textarea name="final_draft" rows="14" class="w-full p-4 border rounded mb-4 text-sm">{{ email.draft_reply or "" }}</textarea>

      <!-- EXPLANATION -->
      <div class="bg-gray-50 text-sm text-gray-800 p-4 rounded border border-gray-300 mb-4 leading-relaxed">
        <strong>Explanation of tone changes:</strong>
        <ul class="list-disc pl-5">
          <li>Started with a more casual greeting ("Hi [Sender's Name]") and used a playful phrase ("We're stoked") to set a warm and approachable tone.</li>
          <li>Used more conversational language throughout the email, such as "just click on the link" to make it sound like a helpful guide rather than an instruction.</li>
          <li>Changed the phrase "If you experience any issues or concerns during this process" to "If you have any questions or need a hand along the way" to sound more supportive.</li>
          <li>Ended with a casual closing ("Cheers") and added "Looking forward to hearing back from you soon!" to leave a positive impression.</li>
        </ul>
      </div>

      <!-- TONE SELECTOR -->
      <div class="mb-4 flex items-center gap-2">
        <label for="tone" class="font-medium">Select Tone:</label>
        <select name="tone" id="tone" class="border rounded p-2">
          <option value="formal">Formal</option>
          <option value="casual">Casual</option>
          <option value="assertive">Assertive</option>
          <option value="friendly">Friendly</option>
          <option value="apologetic">Apologetic</option>
        </select>
      </div>

      <!-- BUTTONS -->
      <div class="flex flex-wrap justify-center gap-3">

        <!-- REWRITE DRAFT BUTTON (hidden tone injected via JS) -->
        <button type="submit" formaction="{{ url_for('rewrite_draft_action', email_id=email.id) }}"
                class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded"
                onclick="document.getElementById('hiddenTone').value = document.getElementById('tone').value">
          ‚úçÔ∏è Rewrite Draft
        </button>

        <!-- SEND BUTTON -->
        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
          üì§ Send Reply
        </button>

        <!-- BACK BUTTON -->
        <a href="{{ url_for('emails') }}" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
          üè† Back to Emails
        </a>
      </div>

      <!-- HIDDEN INPUT for JS tone sync -->
      <input type="hidden" name="tone" id="hiddenTone" value="formal">
    </form>

    <!-- üìÖ MEETING SCHEDULER (now correctly placed inside main container) -->
    <hr class="my-6 border-t-2 border-gray-300">

    <h2 class="text-lg font-semibold mb-3">üìÖ Schedule a Meeting</h2>
    <form method="POST" action="{{ url_for('schedule_meeting', email_id=email.id) }}" class="space-y-4">

      <!-- Recipient -->
      <div>
        <label class="block font-medium mb-1">Recipient Email:</label>
        <input type="email" name="recipient" value="{{ email.from_addr }}" class="w-full border p-2 rounded" required>
      </div>

      <!-- Date -->
      <div>
        <label class="block font-medium mb-1">Date:</label>
        <input type="date" name="date" class="w-full border p-2 rounded" required>
      </div>

      <!-- Start Time -->
      <div>
        <label class="block font-medium mb-1">Start Time:</label>
        <input type="time" name="start_time" class="w-full border p-2 rounded" required>
      </div>

      <!-- End Time -->
      <div>
        <label class="block font-medium mb-1">End Time:</label>
        <input type="time" name="end_time" class="w-full border p-2 rounded" required>
      </div>

      <!-- Optional Title -->
      <input type="hidden" name="title" value="Meeting with Anil">

      <!-- Submit Button -->
      <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded">
        üì® Send Calendar Invite
      </button>
    </form>

  </div> <!-- ‚úÖ CLOSES main white container -->

  <!-- TONE SELECT SYNC -->
  <script>
    const toneSelect = document.getElementById('tone');
    const hiddenTone = document.getElementById('hiddenTone');
    toneSelect?.addEventListener('change', () => {
      if (hiddenTone) hiddenTone.value = toneSelect.value;
    });
    if (hiddenTone) hiddenTone.value = toneSelect?.value;
  </script>

</body>
</html>
